<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TrackEXP by LX2.0 | Powered by ZendriaX</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1fb6aa">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#0b1220;
    --card:#111827;
    --muted:#a6b2c6;
    --text:#e6eef6;
    --accent:#1fb6aa;      /* calm teal = trust */
--accent2:#4a6cf7;    /* stable fintech blue */
--danger:#ef4444;
  --glass: rgba(255,255,255,0.06);
  }
  /* Light theme */
  body.light {
  --bg:#f5f7fb;

  --card:#ffffff;
  --muted:#556070;
  --text:#0b1220;
  --accent:#14b8a6;
  --accent2:#4a6cf7;
  --glass: rgba(0,0,0,0.035);
}


  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  .app{
  max-width:1180px;
  margin:24px auto;
  padding:18px;
  display:grid;
  grid-template-columns:1fr 380px;
  gap:18px;
}
 /* ONLY for history items inside transactions */
.history .history-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;   /* buttons at top */
  flex-direction: row;
  padding: 12px 14px;
  border-radius: 12px;
  background: var(--glass);
  margin-bottom: 12px;
  border: 1px solid rgba(33,195,166,0.45);
box-shadow:
  0 6px 18px rgba(33,195,166,0.15),
  inset 0 1px 0 rgba(255,255,255,0.05);

  
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
}

/* Hover effect */
.history .history-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

/* Left column (text) inside history */
.history .history-item > div:first-child {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Right column (buttons) inside history */
.history .history-item > div:last-child {
  display: flex;
  gap: 8px;
  align-self: flex-start;
}





  .title{
  font-size:28px;
  font-weight:900;
  letter-spacing:-0.03em;
}
  .subtitle{
  color:var(--muted);
  font-size:13px;
  margin-top:4px;
  line-height:1.4;
}
  .toggle{
  padding:8px 14px;
  border-radius:999px;
  border:none;
  background:var(--glass);
  color:var(--text);
  cursor:pointer;
  font-weight:600;
  backdrop-filter: blur(6px);
}
  /* left column */
  .left{display:flex;flex-direction:column;gap:16px}
  .cards{display:flex;gap:12px}
  .card{

  background: var(--card);
  border-radius: 14px;
  padding: 16px;
  box-shadow:
    0 10px 30px rgba(2,6,23,0.45),
    inset 0 1px 0 rgba(255,255,255,0.04);
  border: 1px solid rgba(79,116,255,0.35);
}
  .small-card{flex:1;display:flex;flex-direction:column;gap:8px}
  .small-card .label{color:var(--muted);font-size:12px}
  .small-card .value{font-size:20px;font-weight:700}
  .add-expense{display:flex;gap:12px;align-items:end;flex-wrap:wrap}
  .add-expense .field{min-width:150px;flex:1}
  .btn-primary{
  background: linear-gradient(135deg,#4f74ff,#21c3a6);
  padding: 12px 18px;
  border-radius: 12px;
  color: #fff;
  border: none;
  cursor: pointer;
  font-size: 16px;
  font-weight: 700;
  box-shadow: 0 10px 30px rgba(79,116,255,0.35);
}


  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chart-wrap{
  background: var(--card);
  border-radius:12px;
  padding:14px;
  border:1px solid var(--glass);
}
  /* right column */
  .right{display:flex;flex-direction:column;gap:16px}
  .history{max-height:420px;overflow:auto;padding-right:8px}
@media (max-width: 768px) {
  .history .history-item {
    flex-direction: row;
    align-items: flex-start;
    gap: 12px;
  }

  .history .history-item > div:first-child {
    flex: 1;
  }

  .history .history-item > div:last-child {
    display: flex;
    gap: 6px;
  }
}


  .history-item > div:first-child {
    flex: 1;                /* text takes space */
  }

  .history-item > div:last-child {
    display: flex;
    gap: 6px;
    align-self: flex-start; /* buttons stay top */
  }
}

  padding:10px;
  border-radius:8px;
  background:var(--glass);
  margin-bottom:10px;
}
  .muted{color:var(--muted);font-size:13px}
  .pill{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  background:var(--glass);
  font-weight:600;
  font-size:13px;
}
  .manage{display:flex;gap:12px;flex-direction:column}
  .list{display:flex;flex-direction:column;gap:8px}
  .list .row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:var(--glass)}
  footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:13px;margin-top:10px}

  input,select,textarea{
  background:transparent;
  border:1px solid var(--glass);
  padding:8px;
  border-radius:8px;
  color:var(--text);
  outline:none;
}
  body.light input,body.light .history-item,
body.light .pill,
body.light .list .row{
  background: rgba(0,0,0,0.035);
}
 select,body.light textarea{border-color:rgba(0,0,0,0.6);color:var(--text)}
  button:active{transform:translateY(1px)}
  @media(max-width:1040px){
    .app{grid-template-columns:1fr; padding:12px}
    .right{order:3}
  }
    

  /* ===============================
     MOBILE RESPONSIVE FIXES ONLY
     =============================== */

  @media (max-width: 768px) {
  .header {
    flex-direction: row;
    align-items: center;
    gap: 12px;
  }
}

.header {
  background: var(--card); /* same as other cards */
  box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* optional, to lift it slightly */
}




    .title {
      font-size: 22px;
    }

    .cards {
      flex-direction: column;
    }

    .small-card {
      width: 100%;
    }

    .add-expense {
      flex-direction: column;
      align-items: stretch;
    }

    .add-expense .field {
      width: 100%;
    }

    .btn-primary,
    .toggle {
      width: 100%;
      text-align: center;
    }

    .chart-wrap {
      padding: 10px;
    }

    canvas {
      max-width: 100% !important;
    }

    .history {
      max-height: 320px;
    }

    .history-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .list .row {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    input,
    select,
    textarea,
    button {
      font-size: 15px;
      min-height: 44px;
    }
  }

  @media (max-width: 420px) {
    .title {
      font-size: 20px;
    }

    .subtitle {
      font-size: 12px;
    }

    .value {
      font-size: 18px;
    }
  }
button:hover{
  transform: translateY(-1px);
}

.history-item:hover{
  background: rgba(255,255,255,0.03);
}
  /* Category scroll container */
.cat-scroll{
  max-height: 260px;        /* adjust as you like */
  overflow-y: auto;
  padding-right: 6px;
}

/* Optional: smooth scrollbar look */
.cat-scroll::-webkit-scrollbar{
  width: 6px;
}
.cat-scroll::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,0.2);
  border-radius: 6px;
}
body.light .cat-scroll::-webkit-scrollbar-thumb{
  background: rgba(0,0,0,0.25);
}

/* Collapsible category UI */
.cat-item{
  border-radius:10px;
  background:var(--glass);
  padding:10px;
}

.cat-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.cat-header strong{
  font-size:14px;
}

.chevron{
  transition: transform .25s ease;
  font-size:14px;
  opacity:.7;
}

.cat-item.open .chevron{
  transform: rotate(90deg);
}

.sub-list{
  margin-top:8px;
  padding-left:12px;
  display:none;
  flex-direction:column;
  gap:6px;
}

.cat-item.open .sub-list{
  display:flex;
}

.sub-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:13px;
  padding:6px 8px;
  border-radius:8px;
  background:rgba(255,255,255,0.04);
}

body.light .sub-row{
  background:rgba(0,0,0,0.04);
}
#catSearch:focus{
  border-color: var(--accent);
}
.slideshow {
  width: 100%;
  height: 150px;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  margin-top: 10px; /* optional spacing */
}

.slide {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  color: #fff;
  opacity: 0;
  transition: opacity 1s ease;
  background-size: cover;
  background-position: center;
  text-align: center;
  padding: 5px;
}

.slide.active {
  opacity: 1;
}
/* Header Card Design */
.header {
  background: var(--card);
  border-radius: 16px;
  padding: 12px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  border: 1px solid rgba(255,255,255,0.05);
}

.header > div:first-child {
  display: flex;
  align-items: center;
  gap: 14px;
}

.header img {
  width: 54px;
  height: 54px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

.header .title {
  font-size: 24px;
  font-weight: 900;
}

.header .subtitle {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.4;
}

.header .toggle {
  padding: 8px 16px;
  border-radius: 999px;
  border: none;
  background: var(--accent2);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
  white-space: nowrap;
}

.header .toggle:hover {
  transform: translateY(-1px);
  background: #3f5de0;
}
@media (max-width: 600px) {
  .header {
    padding: 10px 14px;
  }

  .header img {
    width: 42px;
    height: 42px;
    border-radius: 12px;
  }

  .header .title {
    font-size: 18px;
  }

  .header .subtitle {
    font-size: 11px;
  }

  .header .toggle {
    padding: 6px 12px;
    font-size: 13px;
  }
}
.history-item {
  border-left: 4px solid var(--accent);
}

body.light .history-item {
  border-left-color: var(--accent2);
}
@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.history-item {
  animation: fadeUp 0.25s ease;
}

.history-item:hover {
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0.04),
    rgba(255,255,255,0.01)
  );
}
.small-card {
  border: 1px solid rgba(79,116,255,0.35);
}

.small-card:nth-child(2) {
  border-color: rgba(33,195,166,0.45);
}

.small-card:nth-child(3) {
  border-color: rgba(245,158,11,0.45);
}
body.light .card {
  border: 1px solid rgba(74,108,247,0.25);
}

body.light .history-item {
  border: 1px solid rgba(20,184,166,0.35);
}

body.light .small-card {
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
.card:hover {
  box-shadow:
    0 14px 40px rgba(79,116,255,0.25),
    inset 0 1px 0 rgba(255,255,255,0.06);
}

.history-item:hover {
  box-shadow:
    0 12px 30px rgba(33,195,166,0.25);
}


/* =====================================
   FINAL COLOR MAPPING (ONE-SIDE BORDER)
   ===================================== */

/* Default fallback */
.card {
  border-left: 4px solid var(--accent2);
}

/* ===== WALLET SUMMARY ===== */

/* Online */
.cards .small-card:nth-child(1) {
  border-left-color: #22c55e; /* Green */
}

/* Offline */
.cards .small-card:nth-child(2) {
  border-left-color: #f97316; /* Orange */
}

/* Total */
.cards .small-card:nth-child(3) {
  border-left-color: #3b82f6; /* Blue */
}

/* ===== LEFT SECTION ===== */

/* Add Expense */
.left .card:nth-of-type(2) {
  border-left-color: #16a34a; /* Dark Green */
}

/* Analytics */
.left .card:nth-of-type(3) {
  border-left-color: #8b5cf6; /* Purple */
}

/* Transactions */
.left .card:nth-of-type(4) {
  border-left-color: #ef4444; /* Red */
}

/* ===== RIGHT SECTION ===== */

/* Backup & Restore */
.right .card:nth-of-type(1) {
  border-left-color: #06b6d4; /* Cyan */
}

/* Manage Categories */
.right .card:nth-of-type(2) {
  border-left-color: #eab308; /* Yellow */
}

/* ===== HISTORY ITEMS ===== */

.history .history-item {
  border-left: 4px solid #14b8a6; /* Teal */
}

/* ===== LIGHT THEME SUPPORT ===== */

body.light .card {
  border-left-width: 4px;
  border-left-style: solid;
}
/* =====================================
   DIFFERENT ONE-SIDE BORDER PER CARD
   ===================================== */

/* DEFAULT (fallback) */
.card {
  border-left: 4px solid var(--accent2);
}

/* ===== LEFT COLUMN ===== */

/* Wallet cards */
.cards .small-card:nth-child(1) {
  border-left-color: #4f74ff; /* Online - Blue */
}

.cards .small-card:nth-child(2) {
  border-left-color: #21c3a6; /* Offline - Teal */
}

.cards .small-card:nth-child(3) {
  border-left-color: #f59e0b; /* Total - Amber */
}

/* Add Expense card */
.left .card:nth-of-type(2) {
  border-left-color: #22c55e; /* Green */
}

/* Analytics card */
.left .card:nth-of-type(3) {
  border-left-color: #8b5cf6; /* Purple */
}

/* Transactions card */
.left .card:nth-of-type(4) {
  border-left-color: #ef4444; /* Red */
}

/* ===== RIGHT COLUMN ===== */

/* Backup & Restore */
.right .card:nth-of-type(1) {
  border-left-color: #06b6d4; /* Cyan */
}

/* Manage Categories */
.right .card:nth-of-type(2) {
  border-left-color: #f97316; /* Orange */
}

/* ===== HISTORY ITEMS ===== */

.history .history-item {
  border-left: 4px solid #14b8a6; /* Teal for transactions */
}

/* ===== LIGHT THEME BALANCE ===== */

body.light .card {
  border-left-width: 4px;
  border-left-style: solid;
}
.card,
.history-item {
  position: relative;
}

.card::before,
.history-item::before {
  content: "";
  position: absolute;
  left: 0;
  top: 12px;
  bottom: 12px;
  width: 4px;
  border-radius: 8px;
  background: currentColor;
  opacity: 0.9;
}












</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
  <div style="display:flex;align-items:center;gap:14px">
    
    <!-- LOGO -->
    <img src="icon-192.png" alt="TrackEXP Logo"
     style="
       width:54px;
       height:54px;
       border-radius:16px;
       box-shadow:0 8px 24px rgba(0,0,0,0.35);
     ">

    <!-- BRAND TEXT -->
    <div>
      <div class="title">TrackEXP</div>
      <div class="subtitle">
  by <strong>LX2.0</strong> â€¢ powered by <strong>ZendriaX</strong><br>
  <span style="font-size:12px;opacity:.75">
    Smart expense tracking. Zero confusion.
  </span>
        
</div>
      

    </div>

  </div>

  <div style="display:flex;align-items:center;gap:10px">
    <button class="toggle" id="themeToggle">Toggle Light</button>
  </div>
</div>
<div class="slideshow">
  <div class="slide active" style="background-color:#4f74ff">Manage Finances Easily</div>
  <div class="slide" style="background-color:#21c3a6">Track Income & Expense</div>
  <div class="slide" style="background-color:#ffb020">Analytics & Charts</div>
</div>


  <!-- LEFT COLUMN -->
  <div class="left">
    <!-- wallet cards -->
    <div class="cards">
      <div class="card small-card" style="min-width:220px">
        <div class="label">Online</div>
        <div class="value" id="onlineValue">â‚¹0</div>
        <div class="muted">Transactions online</div>
      </div>
      <div class="card small-card" style="min-width:220px">
        <div class="label">Offline</div>
        <div class="value" id="offlineValue">â‚¹0</div>
        <div class="muted">Transactions offline</div>
      </div>
      <div class="card small-card" style="min-width:120px;max-width:140px;justify-content:center;align-items:center">
        <div class="label">Total</div>
        <div class="value" id="totalValue">â‚¹0</div>
      </div>
    </div>

    <!-- add expense -->
    <div class="card">
      <h3 style="margin:0 0 10px 0">Add Expense</h3>
      <div class="add-expense">
        <div class="field" style="flex:1">
          <label class="muted">Category</label><br>
          <select id="catSelect"></select>
        </div>
        <div class="field" style="flex:1">
          <label class="muted">Subcategory</label><br>
          <select id="subSelect"></select>
        </div>
        <div class="field" style="flex:1">
          <label class="muted">Amount</label><br>
          <input type="number" id="amount" placeholder="e.g. 250" step="any">
        </div>
        <div class="field" style="flex:1">
          <label class="muted">Mode</label><br>
          <select id="mode"><option>Online</option><option>Offline</option></select>
        </div>
        <div class="field" style="flex:1">
          <label class="muted">Date</label><br>
          <input type="date" id="date">
        </div>
        <div class="field" style="flex:1">
          <label class="muted">Note</label><br>
          <input id="note" placeholder="optional note">
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px">
        <button class="btn-primary" id="payBtn">Pay (Add)</button>
        <button class="toggle" id="quickAddIncome">Quick Add Income</button>
      </div>
    </div>

    <!-- chart & filters -->
    <div class="card">
      <h3 style="margin:0 0 10px 0">Analytics</h3>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1;min-width:160px">
          <label class="muted">Graph Type</label><br>
          <div style="flex:1;min-width:160px" id="paymentDetailWrap" style="display:none">
  <label class="muted">Online / Offline Type</label><br>
  <select id="paymentDetail">
    <option value="expense">Expense</option>
    <option value="income">Income</option>
  </select>
</div>

          <select id="graphType">
            <option value="category">By Category</option>
            <option value="subcategory">By Subcategory</option>
            <option value="payment">Online vs Offline</option>
            <option value="trend">Trend (Line)</option>
          </select>
        </div>
        <div style="flex:1;min-width:160px">
          <label class="muted">For Subcategory (choose category)</label><br>
          <select id="graphCategory"></select>
        </div>
        <div style="min-width:140px">
          <label class="muted">From</label><br>
          <input type="date" id="from">
        </div>
        <div style="min-width:140px">
          <label class="muted">To</label><br>
          <input type="date" id="to">
        </div>
        <div style="min-width:110px;display:flex;align-items:end">
          <button class="toggle" id="applyFilter">Apply</button>
        </div>
      </div>
     <div id="chartTotal" style="
  font-weight:700;
  margin-bottom:6px;
  text-align:center;
">
  Total: â‚¹0.00
</div>

<canvas id="mainChart" height="140"></canvas>

<div class="muted" style="margin-top:6px">
  Insight: This chart shows where your money is going.
</div>



      </div>
      </div>
    <div class="card">
  <h3 style="margin:0 0 10px 0">Transactions</h3>

  <!-- SEARCH & FILTER -->
  <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
    <input id="searchInput" placeholder="Search category / note" style="flex:1">
    <select id="modeFilter">
      <option value="all">All</option>
      <option value="online">Online</option>
      <option value="offline">Offline</option>
    </select>
  </div>
      <div style="margin-bottom:8px;">
  <label>Show Transactions:</label>
  <select id="timeFilter">
    <option value="7">Past 7 days</option>
    <option value="14">Past 14 days</option>
    <option value="30">This Month</option>
    <option value="all">All</option>
  </select>
</div>


  <div class="history" id="historyList"></div>
  <div style="margin-top:10px" id="summaryBox" class="muted"></div>
</div>

    
  

  <!-- RIGHT COLUMN -->
  <div class="right">
        <!-- BACKUP & RESTORE (NEW FEATURE â€“ DOES NOT AFFECT EXISTING CODE) -->
    <div class="card">
      <h3 style="margin:0 0 10px 0">Backup & Restore (Google Drive)</h3>

      <button class="btn-primary" id="copyBackupBtn">Copy Backup</button>

      <textarea id="restoreBox"
        placeholder="Paste backup text from Google Drive / Keep here"
        style="margin-top:10px;height:90px"></textarea>

      <button class="toggle" id="restoreBackupBtn">Restore</button>

      <div class="muted" style="margin-top:8px">
        Copy â†’ paste into Google Drive / Keep. No files needed.
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px 0">Manage Categories</h3>
      <div class="manage">
        <div style="display:flex;gap:8px">
          <input id="newCategory" placeholder="New category name">
          <button class="btn-primary" id="addCategoryBtn">Add</button>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <select id="manageCategory"></select>
          <input id="newSubName" placeholder="New subcategory">
          <button class="btn-primary" id="addSubBtn">Add Sub</button>
        </div>

 <div style="margin-top:12px">
   <input
  id="catSearch"
  placeholder="Search category / subcategory"
  style="margin-bottom:10px;width:100%"
>

  <div class="muted" style="margin-bottom:8px">Categories</div>

  <div class="cat-scroll">
    <div class="list" id="catList"></div>
  </div>
</div>

      </div>
    </div>

  

  <footer>
  TrackEXP by LX2.0 â€¢ Powered by ZendriaX â€¢ Data saved locally
</footer>
</div>

<script>
  function renderCatList(){
  catList.innerHTML = '';

  // SORT CATEGORIES A â†’ Z
  const sortedCats = Object.keys(state.categories)
    .sort((a,b) => a.localeCompare(b, 'en', {sensitivity:'base'}));

  sortedCats.forEach(cat => {

    const catItem = document.createElement('div');
    catItem.className = 'cat-item';

    /* HEADER */
    const header = document.createElement('div');
    header.className = 'cat-header';

    const title = document.createElement('strong');
    const subs = Object.keys(state.categories[cat]);
    title.textContent = `${cat}${subs.length ? ` (${subs.length})` : ''}`;

    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.gap = '6px';
    right.style.alignItems = 'center';

    const chev = document.createElement('span');
    chev.className = 'chevron';
    chev.textContent = 'â–¶';

    const editBtn = document.createElement('button');
    editBtn.className = 'toggle';
    editBtn.textContent = 'Edit';
    editBtn.onclick = (e)=>{
      e.stopPropagation();
      editCategory(cat);
    };

    const delBtn = document.createElement('button');
    delBtn.className = 'toggle';
    delBtn.textContent = 'Delete';
    delBtn.onclick = (e)=>{
      e.stopPropagation();
      deleteCategory(cat);
    };

    right.appendChild(editBtn);
    right.appendChild(delBtn);
    right.appendChild(chev);

    header.appendChild(title);
    header.appendChild(right);

    /* SUBCATEGORIES â€” SORTED A â†’ Z */
    const subList = document.createElement('div');
    subList.className = 'sub-list';

    subs
      .sort((a,b) => a.localeCompare(b, 'en', {sensitivity:'base'}))
      .forEach(sub => {

        const row = document.createElement('div');
        row.className = 'sub-row';

        const name = document.createElement('span');
        name.textContent = sub;

        const actions = document.createElement('div');
        actions.style.display = 'flex';
        actions.style.gap = '6px';

        const eBtn = document.createElement('button');
        eBtn.className = 'toggle';
        eBtn.textContent = 'Edit';
        eBtn.onclick = ()=> editSub(cat, sub);

        const dBtn = document.createElement('button');
        dBtn.className = 'toggle';
        dBtn.textContent = 'Delete';
        dBtn.onclick = ()=> deleteSub(cat, sub);

        actions.appendChild(eBtn);
        actions.appendChild(dBtn);

        row.appendChild(name);
        row.appendChild(actions);
        subList.appendChild(row);
      });

    /* TOGGLE OPEN */
    header.onclick = ()=>{
      catItem.classList.toggle('open');
    };

    catItem.appendChild(header);
    catItem.appendChild(subList);
    catList.appendChild(catItem);
  });
}

/* ------------- Data storage and defaults ------------- */
const KEY = 'wallet_finance_v1';
let state = JSON.parse(localStorage.getItem(KEY) || '{"categories":{},"expenses":[],"wallet":{"online":0,"offline":0}}');

/* ------------- Helpers ------------- */
function save() { localStorage.setItem(KEY, JSON.stringify(state)); }
function formatMoney(n){ return 'â‚¹' + Number(n).toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2}); }

function todayISO(){ return new Date().toISOString().slice(0,10); }

/* ------------- DOM refs ------------- */
const catSelect = document.getElementById('catSelect');
const subSelect = document.getElementById('subSelect');
const amountEl = document.getElementById('amount');
const modeEl = document.getElementById('mode');
const dateEl = document.getElementById('date');
const noteEl = document.getElementById('note');
const payBtn = document.getElementById('payBtn');

const onlineValue = document.getElementById('onlineValue');
const offlineValue = document.getElementById('offlineValue');
const totalValue = document.getElementById('totalValue');

const addCategoryBtn = document.getElementById('addCategoryBtn');
const newCategoryInput = document.getElementById('newCategory');
const manageCategory = document.getElementById('manageCategory');
const addSubBtn = document.getElementById('addSubBtn');
const newSubName = document.getElementById('newSubName');
const catList = document.getElementById('catList');

const historyList = document.getElementById('historyList');
const summaryBox = document.getElementById('summaryBox');
const searchInput = document.getElementById("searchInput");
const modeFilter = document.getElementById("modeFilter");
const timeFilter = document.getElementById("timeFilter");





const graphType = document.getElementById('graphType');
const graphCategory = document.getElementById('graphCategory');
const fromDate = document.getElementById('from');
  
const toDate = document.getElementById('to');
const applyFilter = document.getElementById('applyFilter');

const mainChartCtx = document.getElementById('mainChart').getContext('2d');
let mainChart = null;
  const chartTotalEl = document.getElementById('chartTotal');


/* ------------- Theme ------------- */
const themeToggle = document.getElementById('themeToggle');
const THEME_KEY = 'wallet_theme_v1';
function applyTheme() {
  const t = localStorage.getItem(THEME_KEY);
  if (t === 'light') document.body.classList.add('light');
  else document.body.classList.remove('light');
  themeToggle.textContent = (t === 'light') ? 'Toggle Dark' : 'Toggle Light';
}
themeToggle.addEventListener('click', ()=>{
  const cur = localStorage.getItem(THEME_KEY) === 'light' ? 'dark' : 'light';
  localStorage.setItem(THEME_KEY, cur);
  applyTheme();
});
applyTheme();

/* ------------- Population functions ------------- */
function refreshCategorySelectors(){
  // fill selects for cat/sub
  catSelect.innerHTML = '';
  manageCategory.innerHTML = '';
  graphCategory.innerHTML = '';
  const cats = Object.keys(state.categories);
  if (cats.length === 0){
    catSelect.innerHTML = '<option disabled selected>Create a category</option>';
    manageCategory.innerHTML = '<option disabled selected>No categories</option>';
    graphCategory.innerHTML = '<option disabled selected>No categories</option>';
    subSelect.style.display = 'none';
  } else {
    cats.forEach(c => {
      const opt = document.createElement('option'); opt.value = c; opt.textContent = c; catSelect.appendChild(opt);
      const mo = opt.cloneNode(true); manageCategory.appendChild(mo);
      const go = opt.cloneNode(true); graphCategory.appendChild(go);
    });
    updateSubOptions();
  }
  renderCatList();
}

function updateSubOptions(){
  subSelect.innerHTML = '';
  const c = catSelect.value;
  if(!c || !state.categories[c] || Object.keys(state.categories[c]).length === 0){
    subSelect.style.display = 'none';
    return;
  }
  subSelect.style.display = 'inline-block';
  const noneOpt = document.createElement('option'); noneOpt.value=''; noneOpt.textContent='(none)'; subSelect.appendChild(noneOpt);
  Object.keys(state.categories[c]).forEach(s => {
    const opt = document.createElement('option'); opt.value = s; opt.textContent = s; subSelect.appendChild(opt);
  });
}

 

/* ------------- Category & Subcategory actions ------------- */
addCategoryBtn.addEventListener('click', ()=>{
  const name = newCategoryInput.value.trim();
  if(!name) return alert('Enter category name');
  if(state.categories[name]) return alert('Category exists');
  state.categories[name] = {};
  newCategoryInput.value = '';
  save(); refreshCategorySelectors(); updateCharts();
});
addSubBtn.addEventListener('click', ()=>{
  const cat = manageCategory.value;
  const name = newSubName.value.trim();
  if(!cat) return alert('Choose category');
  if(!name) return alert('Enter subcategory name');
  if(state.categories[cat][name]) return alert('Subcategory exists');
  state.categories[cat][name] = true;
  newSubName.value = '';
  save(); refreshCategorySelectors(); updateCharts();
});

function editCategory(cat){
  if(!confirm('Are you sure you want to edit this category?')) return;
  const newName = prompt('New category name', cat);
  if(!newName || newName.trim()===cat) return;
  if(state.categories[newName]) return alert('A category with that name already exists');
  state.categories[newName] = state.categories[cat];
  delete state.categories[cat];
  // move expenses
  state.expenses.forEach(exp => { if(exp.cat === cat) exp.cat = newName; });
  save(); refreshCategorySelectors(); renderHistory(); updateCharts();
}
function editSub(cat, sub) {
  if (!confirm('Edit this subcategory?')) return;

  const newName = prompt('New subcategory name', sub);
  if (!newName || newName.trim() === sub) return;
  if (state.categories[cat][newName]) return alert('A subcategory with that name already exists');

  // Rename subcategory in categories
  state.categories[cat][newName] = state.categories[cat][sub];
  delete state.categories[cat][sub];

  // Update existing expenses
  state.expenses.forEach(exp => {
    if (exp.cat === cat && exp.sub === sub) exp.sub = newName;
  });

  save();
  refreshCategorySelectors();
  renderHistory();
  updateCharts();
}



/* ------------- Expenses ------------- */
payBtn.addEventListener('click', ()=>{
  const cat = catSelect.value;
  if(!cat) return alert('Select category');
  const sub = subSelect.value || '';
  const amt = parseFloat(amountEl.value);
  if(isNaN(amt) || amt === 0) return alert('Enter non-zero amount');
  const mode = modeEl.value;
  const date = dateEl.value || todayISO();
  const note = noteEl.value || '';
  state.expenses.unshift({cat, sub, amount: amt, mode, date, note});
  // adjust wallet totals
  state.wallet[mode.toLowerCase()] = (state.wallet[mode.toLowerCase()]||0) - amt; // expenses reduce wallet
  save();
  amountEl.value = ''; noteEl.value = ''; dateEl.value = '';
  renderHistory(); updateWalletUI(); updateCharts();
});

// Quick add income: prompts amount & mode, adds as positive to wallet & history as income note
document.getElementById('quickAddIncome').addEventListener('click', ()=>{
  const amt = parseFloat(prompt('Enter income amount (positive)'));
  if(isNaN(amt) || amt === 0) return alert('Invalid amount');
  let mode = prompt('Mode (Online/Offline)', 'Online') || 'Online';
mode = mode.toLowerCase() === 'offline' ? 'Offline' : 'Online';
  state.wallet[mode.toLowerCase()] = (state.wallet[mode.toLowerCase()]||0) + amt;
  state.expenses.unshift({cat:'Income', sub:'', amount: amt, mode, date: todayISO(), note:'Income added'});
  save(); renderHistory(); updateWalletUI(); updateCharts();
});

function renderHistory(){
  historyList.innerHTML = '';
  let total = 0, online = 0, offline = 0;
  state.expenses.forEach((e,i) => {
    total += e.amount;
    if(e.mode.toLowerCase() === 'online') online += e.amount;
    else offline += e.amount;
    const div = document.createElement('div'); div.className='history-item';
    const left = document.createElement('div');

left.innerHTML = `
  <div style="font-weight:700;display:flex;justify-content:space-between;align-items:center">
    <span>${e.cat}${e.sub ? ' â†’ ' + e.sub : ''}</span>
  </div>

  <div class="muted">${e.date} â€¢ ${e.mode}</div>

  ${e.note ? `<div class="muted">${e.note}</div>` : ''}

  <div style="margin-top:6px;font-weight:600">
    ${formatMoney(e.amount)}
  </div>
`;

    const right = document.createElement('div');
    const edit = document.createElement('button'); edit.className='toggle'; edit.textContent='Edit';
    edit.addEventListener('click', ()=> editExpense(i));
    const del = document.createElement('button'); del.className='toggle'; del.textContent='Delete';
    del.addEventListener('click', ()=> deleteExpense(i));
    right.appendChild(edit); right.appendChild(del);
    div.appendChild(left); div.appendChild(right);
    historyList.appendChild(div);
  });
  summaryBox.textContent = `Total transactions: ${state.expenses.length} â€¢ Sum: ${formatMoney(total)}`;
  updateWalletUI();
}
  function deleteCategory(cat){
  if(!confirm('Delete category and all its data?')) return;

  const backup = {
    cat,
    subs: {...state.categories[cat]},
    expenses: state.expenses.filter(e => e.cat === cat)
  };

  // Remove
  delete state.categories[cat];
  state.expenses = state.expenses.filter(e => e.cat !== cat);
  save();
  refreshCategorySelectors();
  renderHistory();
  updateCharts();

  // Undo
  showUndo(`Category "${cat}" deleted`, () => {
    state.categories[backup.cat] = backup.subs;
    state.expenses.unshift(...backup.expenses);
    save();
    refreshCategorySelectors();
    renderHistory();
    updateCharts();
  });
}

function deleteSub(cat, sub){
  if(!confirm('Delete this subcategory and its transactions?')) return;

  const backup = {
    cat,
    sub,
    expenses: state.expenses.filter(e => e.cat===cat && e.sub===sub)
  };
  


  // Remove
  delete state.categories[cat][sub];
  state.expenses = state.expenses.filter(e => !(e.cat===cat && e.sub===sub));
  save();
  refreshCategorySelectors();
  renderHistory();
  updateCharts();

  // Undo
  showUndo(`Subcategory "${sub}" deleted`, () => {
    state.categories[backup.cat][backup.sub] = true;
    state.expenses.unshift(...backup.expenses);
    save();
    refreshCategorySelectors();
    renderHistory();
    updateCharts();
  });
}

/* ------------- Edit & Delete expense ------------- */
function editExpense(i){
  if(!confirm('Edit this expense?')) return;
  const e = state.expenses[i];
  const newAmt = prompt('Amount', e.amount);
  if(newAmt !== null){
    const v = Number(newAmt);
    if(isNaN(v) || v === 0) return alert('Invalid amount');
    // adjust wallet amounts: reverse previous effect then apply new
    const prevMode = e.mode.toLowerCase();
    state.wallet[prevMode] = (state.wallet[prevMode] || 0) + e.amount; // give back previously subtracted
    e.amount = v;
    state.wallet[e.mode.toLowerCase()] = (state.wallet[e.mode.toLowerCase()]||0) - e.amount; // subtract new
  }
  const newNote = prompt('Note', e.note);
  if(newNote !== null) e.note = newNote;
  const newMode = prompt('Mode (Online/Offline)', e.mode);
  if(newMode !== null){ 
    // if mode changed, adjust wallet movement
    if(newMode !== e.mode){
      // revert old
      state.wallet[e.mode.toLowerCase()] = (state.wallet[e.mode.toLowerCase()]||0) + e.amount;
      e.mode = newMode;
      state.wallet[e.mode.toLowerCase()] = (state.wallet[e.mode.toLowerCase()]||0) - e.amount;
    }
  }
  save(); renderHistory(); updateCharts();
}

function deleteExpense(i){
  if(!confirm('Delete this transaction?')) return;

  const removed = state.expenses[i];
  const modeKey = removed.mode.toLowerCase();

  // ðŸ”¥ FIX: reverse effect based on type
  if (removed.cat === 'Income') {
    // Income was added â†’ subtract on delete
    state.wallet[modeKey] -= removed.amount;
  } else {
    // Expense was subtracted â†’ add back on delete
    state.wallet[modeKey] += removed.amount;
  }

  state.expenses.splice(i,1);
  save();
  renderHistory();
  updateCharts();

  // UNDO
  showUndo('Transaction deleted', () => {
    state.expenses.splice(i,0,removed);

    if (removed.cat === 'Income') {
      state.wallet[modeKey] += removed.amount;
    } else {
      state.wallet[modeKey] -= removed.amount;
    }

    save();
    renderHistory();
    updateCharts();
  });
}



/* ------------- Wallet UI ------------- */
function updateWalletUI(){
  // FORCE numbers (prevents NaN forever)
  const online = Number(state.wallet.online) || 0;
  const offline = Number(state.wallet.offline) || 0;

  // Save back normalized values
  state.wallet.online = online;
  state.wallet.offline = offline;

  onlineValue.textContent = formatMoney(online);
  offlineValue.textContent = formatMoney(offline);
  totalValue.textContent = formatMoney(online + offline);
}


/* ------------- Charts ------------- */


  

function palette(n){
 const base = ['#4a6cf7','#14b8a6','#f59e0b','#ef4444','#8b5cf6','#f97316','#06b6d4','#22c55e','#ec4899'];
  const out = [];
  for(let i=0;i<n;i++) out.push(base[i % base.length]);
  return out;
}

/* ------------- Init ------------- */
function initDefaults(){
  if(!state.categories || typeof state.categories !== 'object') state.categories = {};
  if(!state.expenses) state.expenses = [];
  if(!state.wallet) state.wallet = {online:0,offline:0};
  if(state.expenses.length === 0 && Object.keys(state.categories).length === 0){
    // sample categories to make UI friendly on first run
    state.categories['Food'] = {'Dairy':true,'Snacks':true,'Groceries':true};
    state.categories['Rent'] = {};
    state.categories['Electricity'] = {};
    // sample wallet
    state.wallet.online = 0;
    state.wallet.offline = 0;
    save();
  }
  refreshCategorySelectors(); renderHistory(); updateWalletUI(); updateCharts();
}
initDefaults();

/* ------------- Events for selectors and apply ------------- */
catSelect.addEventListener('change', updateSubOptions);
manageCategory.addEventListener('change', updateSubOptions);
graphCategory.addEventListener('change', updateCharts);
applyFilter.addEventListener('click', updateCharts);
searchInput.addEventListener("input", renderHistory);
modeFilter.addEventListener("change", renderHistory);
timeFilter.addEventListener("change", renderHistory);

  
/* ------------- Helper functions for category edit buttons created dynamically ------------- */
/* We used closure functions editCategory/deleteCategory earlier */
/* Additionally implement subcategory editing UI in cat list: show sub list with edit/delete actions */
(function attachSubUi(){
  // Create dynamic UI for subcategory editing when category is selected in manageCategory
  manageCategory.addEventListener('change', ()=>{
    const cat = manageCategory.value;
    // Build a small dialog below manage controls to show subs with edit/delete
    // We'll reuse existing functions editSub/deleteSub via confirm prompts
    // For simplicity show inline under catList (renderCatList already shows edit/delete for categories).
    // To show sub actions, when manageCategory changes, show sub rows:
    const subArea = document.getElementById('subArea');
    // Not needed separately; use separate function to show sub rows under cat
    // We'll implement showing sub rows next time if user requests UI refinement.
  });
})();

/* ------------- Ensure save on unload ------------- */
window.addEventListener('beforeunload', ()=> save());
  
/* =========================================================
   BACKUP & RESTORE â€” FIXED & SAFE
========================================================= */
  function setChartTotal(text, amount){
  chartTotalEl.textContent = `${text}: ${formatMoney(amount)}`;
}

function updateCharts(){
  const type = graphType.value;
  const from = fromDate.value;
  const to = toDate.value;

  const list = state.expenses.filter(e =>
    (!from || e.date >= from) && (!to || e.date <= to)
  );

  const ctx = mainChartCtx;
  if (mainChart) mainChart.destroy();

  /* ================= ONLINE / OFFLINE ================= */
  if (type === 'payment') {
    const detail = paymentDetail.value;
    const map = { Online: 0, Offline: 0 };
    let total = 0;

    list.forEach(e => {
      const isIncome = e.cat === 'Income';
      if (detail === 'expense' && isIncome) return;
      if (detail === 'income' && !isIncome) return;

      map[e.mode] += e.amount;
      total += e.amount;
    });

    setChartTotal(
      detail === 'income' ? 'Total Income' : 'Total Expense',
      total
    );

    mainChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Online', 'Offline'],
        datasets: [{
          data: total ? [map.Online, map.Offline] : [1,1],
          backgroundColor: ['#4f74ff', '#21c3a6']
        }]
      },
      options: {
        plugins: {
          tooltip: {
            callbacks: {
              label: c => {
                if (!total) return 'No data';
                const p = ((c.raw / total) * 100).toFixed(1);
                return `${c.label}: ${formatMoney(c.raw)} (${p}%)`;
              }
            }
          }
        }
      }
    });
    return;
  }

  /* ================= CATEGORY ================= */
  if (type === 'category') {
    const map = {};
    let total = 0;

    list.forEach(e => {
      if (e.cat === 'Income') return;
      map[e.cat] = (map[e.cat] || 0) + e.amount;
      total += e.amount;
    });

    setChartTotal('Total Expense', total);

    const labels = Object.keys(map);
    if (!labels.length) return;

    mainChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels,
        datasets: [{
          data: Object.values(map),
          backgroundColor: palette(labels.length)
        }]
      },
      options: {
        plugins: {
          tooltip: {
            callbacks: {
              label: c => {
                const p = ((c.raw / total) * 100).toFixed(1);
                return `${c.label}: ${formatMoney(c.raw)} (${p}%)`;
              }
            }
          }
        }
      }
    });
    return;
  }

  /* ================= SUBCATEGORY ================= */
  if (type === 'subcategory') {
    const cat = graphCategory.value;
    if (!cat) return;

    const map = {};
    let total = 0;

    list.forEach(e => {
      if (e.cat !== cat || e.cat === 'Income' || !e.sub) return;
      map[e.sub] = (map[e.sub] || 0) + e.amount;
      total += e.amount;
    });

    setChartTotal(`Total ${cat}`, total);

    const labels = Object.keys(map);
    if (!labels.length) return;

    mainChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels,
        datasets: [{
          data: Object.values(map),
          backgroundColor: palette(labels.length)
        }]
      },
      options: {
        plugins: {
          tooltip: {
            callbacks: {
              label: c => {
                const p = ((c.raw / total) * 100).toFixed(1);
                return `${c.label}: ${formatMoney(c.raw)} (${p}%)`;
              }
            }
          }
        }
      }
    });
    return;
  }
  

 /* ================= TREND ================= */
  if (type === 'trend') {
    let total = 0;
    const map = {};

    list.forEach(e => {
      map[e.date] = (map[e.date] || 0) + e.amount;
      total += e.amount;
    });

    setChartTotal('Total Amount', total);

    const labels = Object.keys(map).sort();
    if (!labels.length) return;

    mainChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Amount',
          data: labels.map(d => map[d]),
          borderColor: '#4f74ff',
          fill: false
        }]
      }
    });
  }
}


  
const copyBackupBtn = document.getElementById('copyBackupBtn');
const restoreBackupBtn = document.getElementById('restoreBackupBtn');
const restoreBox = document.getElementById('restoreBox');

copyBackupBtn.addEventListener('click', () => {
  const backupText = "WF_BACKUP_V1\n" + JSON.stringify(state);

  // Try clipboard first
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(backupText).then(() => {
      alert("Backup copied successfully.\nPaste it into Google Drive / Keep.");
    }).catch(() => {
      restoreBox.value = backupText;
      alert("Clipboard blocked.\nBackup placed in text box â€“ copy manually.");
    });
  } else {
    // Fallback
    restoreBox.value = backupText;
    alert("Clipboard not supported.\nBackup placed in text box â€“ copy manually.");
  }
});

restoreBackupBtn.addEventListener('click', () => {
  const text = restoreBox.value.trim();

  if (!text.startsWith("WF_BACKUP_V1")) {
    alert("Invalid backup format");
    return;
  }

  try {
    const json = text.replace("WF_BACKUP_V1", "").trim();
    const importedState = JSON.parse(json);

    // Validate minimal structure
    if (
      typeof importedState !== "object" ||
      !importedState.categories ||
      !importedState.expenses ||
      !importedState.wallet
    ) {
      alert("Backup data is corrupted");
      return;
    }

    // Replace full state safely
    state = importedState;
    // Normalize wallet values after restore
state.wallet.online = Number(state.wallet.online) || 0;
state.wallet.offline = Number(state.wallet.offline) || 0;

    localStorage.setItem(KEY, JSON.stringify(state));

    // Full refresh
    refreshCategorySelectors();
    renderHistory();
    updateWalletUI();
    updateCharts();

    restoreBox.value = "";
    alert("Backup restored successfully");

  } catch (e) {
    alert("Restore failed: Invalid JSON");
  }
});
  

function renderHistory(){
  historyList.innerHTML = '';

  const query = (searchInput?.value || '').toLowerCase();
  const modeVal = modeFilter?.value || 'all';
  const days = timeFilter?.value || '7';
  


  // Calculate the start date based on the selection
  let fromDate = new Date();
  if (days !== 'all') {
    fromDate.setDate(fromDate.getDate() - parseInt(days));
  } else {
    fromDate = new Date('1970-01-01'); // include all history
  }
  const toDate = new Date(); // today

  // Filter expenses by date
  const filteredExpenses = state.expenses.filter(e => {
    const d = new Date(e.date);
    return d >= fromDate && d <= toDate;
  });

  let total = 0;

  filteredExpenses.forEach((e,i) => {

    // SEARCH MATCH
    const text = `${e.cat} ${e.sub} ${e.note}`.toLowerCase();
    if (query && !text.includes(query)) return;

    // MODE FILTER
    if (modeVal !== 'all' && e.mode.toLowerCase() !== modeVal) return;

    total += e.amount;

    
const div = document.createElement('div');
div.className = 'history-item';

const left = document.createElement('div');
left.style.flex = '1';

left.innerHTML = `
  <div style="font-weight:700;font-size:15px">
    ${e.cat}${e.sub ? ' â†’ ' + e.sub : ''}
  </div>

  <div class="muted" style="font-size:12px">
    ${e.date} â€¢ ${e.mode}
  </div>

  ${e.note ? `<div class="muted" style="font-size:12px">${e.note}</div>` : ''}

  <div style="
    margin-top:6px;
    font-weight:800;
    font-size:16px;
    color: var(--accent);
  ">
    ${formatMoney(e.amount)}
  </div>
`;


const right = document.createElement('div');
right.style.display = 'flex';
right.style.gap = '6px';
right.style.alignItems = 'flex-start';

const edit = document.createElement('button');
edit.className='toggle';
edit.textContent='Edit';
edit.onclick = ()=> editExpense(i);

const del = document.createElement('button');
del.className='toggle';
del.textContent='Delete';
del.onclick = ()=> deleteExpense(i);

right.appendChild(edit);
right.appendChild(del);

div.appendChild(left);
div.appendChild(right);
historyList.appendChild(div);
 });

  summaryBox.textContent =
    `Showing results â€¢ Total amount: ${formatMoney(total)}`;

  updateWalletUI();
}

  
  const catSearch = document.getElementById('catSearch');

catSearch.addEventListener('input', () => {
  const q = catSearch.value.toLowerCase().trim();

  document.querySelectorAll('.cat-item').forEach(item => {

    const catTitle = item.querySelector('.cat-header strong');
    const catName = catTitle.textContent.toLowerCase();

    const subRows = item.querySelectorAll('.sub-row');

    let categoryMatch = catName.includes(q);
    let subMatchFound = false;

    subRows.forEach(row => {
      const subName = row.querySelector('span').textContent.toLowerCase();
      const subMatch = subName.includes(q);

      // CASE 1: category matched â†’ show ALL subcategories
      if (categoryMatch || !q) {
        row.style.display = 'flex';
      }
      // CASE 2: only subcategory matched
      else if (subMatch) {
        row.style.display = 'flex';
        subMatchFound = true;
      }
      // CASE 3: hide others
      else {
        row.style.display = 'none';
      }
    });

    const shouldShow = !q || categoryMatch || subMatchFound;

    // Show / hide category
    item.style.display = shouldShow ? 'block' : 'none';

    // Auto open when searching
    if (q && shouldShow) {
      item.classList.add('open');
    }

    // Reset when search cleared
    if (!q) {
      item.classList.remove('open');
    }
  });
});

  let undoTimer = null;
let undoAction = null;

function showUndo(message, action){
  const toast = document.getElementById('undoToast');
  const msg = document.getElementById('undoMsg');
  const btn = document.getElementById('undoBtn');

  msg.textContent = message;
  toast.style.display = 'flex';
  undoAction = action;

  clearTimeout(undoTimer);
  undoTimer = setTimeout(hideUndo, 5000);

  btn.onclick = () => {
    if (undoAction) undoAction();
    hideUndo();
  };
}

function hideUndo(){
  document.getElementById('undoToast').style.display = 'none';
  undoAction = null;
}
  let currentSlide = 0;
const slides = document.querySelectorAll('.slideshow .slide');

setInterval(() => {
  slides[currentSlide].classList.remove('active');
  currentSlide = (currentSlide + 1) % slides.length;
  slides[currentSlide].classList.add('active');
}, 4000); // change slide every 4 seconds


const paymentDetail = document.getElementById('paymentDetail');
const paymentDetailWrap = document.getElementById('paymentDetailWrap');
// Hide paymentDetailWrap by default
paymentDetailWrap.style.display = 'none';

// Show it only when graph type is "payment"
graphType.addEventListener('change', () => {
  if (graphType.value === 'payment') {
    paymentDetailWrap.style.display = 'block';
  } else {
    paymentDetailWrap.style.display = 'none';
  }
  updateCharts();
});

// Update chart when income/expense dropdown changes
paymentDetail.addEventListener('change', updateCharts);



  

</script>
  <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker registered"))
      .catch(err => console.log("SW error:", err));
  });
}

</script>

  <div id="undoToast" style="
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:var(--card);
  color:var(--text);
  padding:14px 18px;
  border-radius:14px;
  display:none;
  align-items:center;
  gap:12px;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
  z-index:9999;
">
  <span id="undoMsg"></span>
  <button id="undoBtn" class="toggle">Undo</button>
</div>


</body>

</html>